(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7dfa7e5a"],{"0325":function(e,t,i){"use strict";i("2fad")},"236b":function(e,t,i){"use strict";i.r(t);var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"naraka-map-inter"},[i("div",{staticClass:"nav"},[i("div",{staticClass:"back",on:{click:function(t){return e.$router.back()}}}),i("div",{staticClass:"title"},[e._v("永劫无间金堆地图")]),i("div",{staticClass:"share",on:{click:e.share}})]),e.mapResource?i("Map",{ref:"mapvm",staticClass:"map",attrs:{zoom:6,tileImageProvider:e.mapTileGenerator,bounds:e.mapResource.bounds},on:{"click-map":e.showCreatePoiPopup}}):e._e(),i("PoiFilter",{directives:[{name:"show",rawName:"v-show",value:e.showFilter,expression:"showFilter"}],ref:"filter",staticClass:"filter",attrs:{items:e.categories},on:{close:function(t){e.showFilter=!1},"item-change":e.switchMarkersRelate,"all-item-change":e.switchAllMarkers}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showCreatePoiWindow,expression:"showCreatePoiWindow"}],staticClass:"create-poi-container",on:{click:function(t){return t.target!==t.currentTarget?null:e.cancelCreatePoi(t)}}},[i("div",{ref:"createPoiPopup",staticClass:"create-poi-popup",style:{top:e.createPoiPopupPositionTop+"px",left:e.createPoiPopupPositionLeft+"px"}},[i("el-select",{staticStyle:{width:"148px"},attrs:{placeholder:"选择点位类型",size:"mini"},model:{value:e.poiType,callback:function(t){e.poiType=t},expression:"poiType"}},e._l(e.poiTypes,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),i("el-input",{staticStyle:{width:"148px","margin-top":"5px"},attrs:{size:"mini",placeholder:"点位名称"},model:{value:e.poiName,callback:function(t){e.poiName=t},expression:"poiName"}}),i("div",{staticClass:"button",on:{click:e.createPoi}})],1)]),i("Login",{directives:[{name:"show",rawName:"v-show",value:e.showWebLogin,expression:"showWebLogin"}],on:{close:function(t){return e.switchWeblogin(!1)},login:e.webLoginSuccess}}),i("Menubar",{staticClass:"menus",attrs:{items:e.menus},on:{"click-item":e.doMenuAction}}),i("Sharebar",{directives:[{name:"show",rawName:"v-show",value:e.showShare,expression:"showShare"}],on:{close:function(t){e.showShare=!1},share:e.shareMapTo}}),i("script",{attrs:{id:"infowindow-template",type:"x-tmpl-mustache"}},[e._v(' <div style=" width: 32vh; height: 32vh; background-image: url(#{background}#); background-repeat: no-repeat; background-size: 100% 100%; display: flex; flex-direction: column; " > <div style=" width: 100%; height: 10vh; color: #5c5c5c; line-height: 10vh; text-align: center; font-weight: bold; font-size: 2vh; overflow: hidden; " > <span style=" display: inline-block; vertical-align: middle; line-height: 5vh; word-break: break-all; " >地点：#{place}#</span > </div> <div style=" width: 100%; height: 10vh; color: #5c5c5c; line-height: 10vh; text-align: center; font-weight: bold; font-size: 2.5vh; overflow: hidden; " > 先行者：#{person}# </div> <div style=" width: 100%; height: 12vh; display: flex; justify-content: center; align-items: center; " > <button style=" height: 5vh; width: 13vh; border-radius: 2.5vh; background-color: #3a393a; color: #ffffff; font-weight: bold; font-size: 2vh; margin-right: 1vh; cursor: pointer; " onclick="window.__tg_map_redirect_challenge__(\'#{target}#\', \'#{target_param}#\', #{native}#)" > 查看视频 </button> </div> </div> ')])],1)},n=[],a=(i("99af"),i("4160"),i("a15b"),i("d81d"),i("b0c0"),i("7039"),i("d3b7"),i("ac1f"),i("25f0"),i("5319"),i("159b"),i("5c96")),r=i("a5c9"),s=i("cdca"),c=i("0a9b"),h=i("a3d2"),u=i("d4a1"),l=i("9dbb"),p=i.n(l),d=i("4dec"),f=i("495f"),v=i("7feb"),m=i("b1b0"),g=i.n(m),w=!1,b={name:"YuanshenMap",metaInfo:function(){return{title:"永劫无间 | 高能时刻短视频",meta:[{hid:"description",name:"description",content:"高能时刻游戏短视频app，快来这个社区我给你看个宝贝"},{hid:"Keywords",name:"Keywords",content:"高能时刻,游戏短视频"}]}},components:{Map:r["a"],Menubar:c["a"],PoiFilter:h["a"],Sharebar:s["a"],Login:u["a"]},data:function(){return{menus:[{id:0,title:"点位筛选",icon:"map-menu-ys-poifilter",action:"filterPoi"}],inApp:!1,client:"",categories:[],pois:{},poiType:"",poiName:"",markers:{},showCreatePoiWindow:!1,createPoiPopupPositionTop:0,createPoiPopupPositionLeft:0,showFilter:!1,showShare:!1,userInfo:{},isMine:!1,activeIDs:{},showWebLogin:!1,mapResource:{id:7,webpURL:"https://img.topgamers.cn/activity/naraka/naraka",pngURL:"https://img.topgamers.cn/activity/naraka/naraka",shareTitle:"永劫无间金堆地图",shareContent:"永劫无间资源点位地图"},infowindow:null,loading:{instance:null,count:0}}},methods:{share:function(){this.showShare=!0},resolveMapResource:function(){var e=this;return new Promise((function(t,i){Object(f["g"])().then((function(i){var o=e.mapResource;o.url=o.pngURL,o.postfix="png",e.mapResource=o,t()}))}))},mapTileGenerator:function(e){var t=this.mapResource,i=t.url,o=t.postfix;return"".concat(i).concat(e).concat(o)},fetchUserInfo:function(){var e=this;if(w)Object(f["a"])({method:"getUserInfo"}).then((function(t){var i=JSON.parse(t)||{};e.userInfo=i;var o={USERINFO:i};return i.loginToken&&(o.LOGINTOKEN=i.loginToken),i.userId&&(o.USERID=i.userId),Object(v["b"])(o),Promise.resolve(e.userInfo)}));else try{this.userInfo=JSON.parse(this.$cookie.get("USERINFO"))||{}}catch(t){this.$cookie.remove("USERINFO")}},requireLogin:function(){var e=this;w?Object(f["a"])({method:"login"}).then((function(){return e.cancelCreatePoi(),Object(f["a"])({method:"getUserInfo"}).then((function(t){e.userInfo=JSON.parse(t);var i={USERINFO:t};return Object(v["b"])(i),Promise.resolve(e.userInfo)}))})):this.switchWeblogin(!0)},switchWeblogin:function(e){this.showWebLogin=e},webLoginSuccess:function(e){this.userInfo=JSON.parse(e),this.switchWeblogin(!1)},resetMapData:function(){var e=this;Object.getOwnPropertyNames(this.markers).forEach((function(t){var i=e.markers[t];"[object Array]"===Object.prototype.toString.call(i)&&i.forEach((function(e){e.removeFromMap()}))})),this.pois={},this.markers={},this.activeIDs=[]},reloadPoints:function(){this.resetMapData(),this.loadPoints()},loadPointCaterories:function(){var e=this,t={activity_id:7};Object(d["b"])(t).then((function(t){var i=t;200===i.code?(e.categories=i.data.map((function(e){return e.is_default?e.active=!0:e.active=!1,e})),e.categories.length>0&&e.loadPoints()):e.$toast(i.msg,{duration:1500})}))},getLoadCategories:function(){var e=this,t=[],i=[];return this.categories.forEach((function(o){var n="marker-".concat(o.id);o.active&&i.push(n);var a=e.markers[n];o.active&&"[object Array]"!==Object.prototype.toString.call(a)?t.push(o.id):o.active&&!e.activeIDs[n]&&e.switchMarkersRelate(o)})),this.activeIDs=i,t},loadPoints:function(){var e=this,t=this.getLoadCategories();if(!(t.length<1)){var i={is_mine:this.is_mine,show_all:!0,category_id:t.join(",")};i=Object.assign(i,this.userInfo),Object(d["d"])(i).then((function(t){var i=t;200===i.code?t.data.forEach((function(t){if(!(t.points.length<1)){var i="marker-"+t.category_id,o=e.pois[i];"[object Array]"!==Object.prototype.toString.call(o)&&(e.pois[i]=[]),t.points.forEach((function(t){e.pois[i].push(t)}));var n=[];e.pois[i].forEach((function(t){var i=e.$refs.mapvm.addMarker({lat:+t.lat,lng:+t.lng,icon:t.marker},(function(i,o){e.showInfowindow(i,o,t)}));n.push(i)})),e.markers[i]=n}})):e.$toast(i.msg,{duration:1500})}))}},doMenuAction:function(e){var t=this[e.action];t&&t(e)},filterPoi:function(){this.showFilter=!0},showCreatePoiPopup:function(e){var t=this;this.showCreatePoiWindow=!0,this.$nextTick().then((function(){var i=e.latLng,o=i.lat,n=i.lng,a=e.pixel,r=a.x,s=a.y,c=t.$refs.createPoiPopup,h=c.offsetHeight,u=c.offsetWidth,l=window,p=l.innerHeight,d=l.innerWidth,f=r,v=d-r,m=s,g=p-s,w=40;t.createPoiPopupPositionLeft=f>v?r-w-u:r+w,(t.createPoiPopupPositionLeft+u>d||t.createPoiPopupPositionLeft<0)&&(t.createPoiPopupPositionLeft=(d-u)/2),t.createPoiPopupPositionTop=m>g?s-h:s+w+10,t.createPoiPopupPositionTop<0?t.createPoiPopupPositionTop=s+w:t.createPoiPopupPositionTop+h>p&&(t.createPoiPopupPositionTop=s-h-w);var b=t.$refs.mapvm.addMarker({lat:o(),lng:n()});t.tempMarkerForAddingPoi=b}))},cancelCreatePoi:function(){this.tempMarkerForAddingPoi.removeFromMap(),this.showCreatePoiWindow=!1},createPoi:function(){var e=this;if(this.poiType)if(this.poiName)if(this.userInfo.userId){this.showLoading();var t=this.tempMarkerForAddingPoi.position,i={lat:"".concat(t.lat()),lng:"".concat(t.lng()),category_id:this.poiType,name:this.poiName,activity_id:this.mapResource.id,userId:this.userInfo.userId+"",sign:this.userInfo.sign};Object(d["a"])(i).then((function(t){setTimeout((function(){e.closeLoading();var i=t.code,o=t.msg;200===i?(e.$toast("创建成功，等待审核通过后将在地图上显示",{duration:3e3}),e.cancelCreatePoi()):e.$toast(o,{duration:3e3})}),1e3)}))}else this.requireLogin();else this.$toast("请输入点位名称",{duration:1500});else this.$toast("请先确定点位类型",{duration:1500})},openMyMap:function(e){var t=this;this.inApp?e.selected?(e.selected=!1,this.is_mine=!1,this.resetMapData(),this.loadPoints()):this.fetchUserInfo().then((function(){t.userInfo.userId&&t.userInfo.sign&&(e.selected=!0,t.is_mine=!0,t.resetMapData(),t.loadPoints())})):this.$toast("请前往app使用此功能",{duration:1500})},shareMap:function(){this.showShare=!0},shareMapTo:function(e){var t=this,i=Object(f["b"])(location.href,"inapp");if("Copy2Clipboard"===e.identifier)this.$copyText(i).then((function(e){t.$toast("复制成功",{duration:1500})}),(function(e){alert("复制失败")}));else{var o={method:"share",appType:e.identifier,msgType:"link",url:i,imageUrl:"https://img.topgamers.cn/icon.png",title:"永劫无间金堆地图",content:"永劫无间资源点位地图"};Object(f["a"])(o)}this.showShare=!1},switchMarkersRelate:function(e){var t=this,i="marker-".concat(e.id),o=this.markers[i];"[object Array]"===Object.prototype.toString.call(o)?(o.forEach((function(i){e.active?i.setMap(t.$refs.mapvm.map):i.setMap(null)})),this.activeIDs=[],this.categories.forEach((function(e){e.active&&t.activeIDs.push("marker-".concat(e.id))}))):e.active&&this.loadPoints()},switchAllMarkers:function(e){var t=this;e?this.loadPoints():(this.categories.forEach((function(e){t.switchMarkersRelate(e)})),this.activeIDs=[])},showInfowindow:function(e,t,i){this.infowindow&&this.infowindow.close();var o=document.getElementById("infowindow-template").innerHTML;o=o.replace(/#{(\w+)}#/g,"{{$1}}");var n={background:g.a,place:i.name,person:i.first_member_name,target:i.redirect_type,target_param:i.redirect_params,native:this.inApp},a=p.a.render(o,n);this.infowindow=this.$refs.mapvm.createInfoWindow(e,a)},showLoading:function(){this.loading.instance||(this.loading.instance=a["Loading"].service({fullscreen:!0,background:"rgba(0, 0, 0, 0.65)"})),this.loading.count+=1},closeLoading:function(){var e=this;this.loading.count<=0||(this.loading.count-=1,this.loading.count<=0&&this.$nextTick((function(){e.loading.instance.close(),e.loading.instance=null})))}},computed:{validMenus:function(){var e=this,t=[];return this.menus.forEach((function(i){(!i.needInApp||i.needInApp&&e.inApp)&&t.push(i)})),t},poiTypes:function(){return this.categories.map((function(e){return{label:e.name,value:e.id}}))}},created:function(){this.inApp=Object(f["d"])(),this.client=Object(f["c"])(),"isPc"!==this.client&&(this.defaultZoom=5)},mounted:function(){var e=this;this.fetchUserInfo(),this.resolveMapResource().then((function(){e.loadPointCaterories()}))}},P=b,k=(i("0325"),i("2877")),y=Object(k["a"])(P,o,n,!1,null,"ad99929c",null);t["default"]=y.exports},"2fad":function(e,t,i){},"7feb":function(e,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"a",(function(){return r}));i("d3b7"),i("25f0");var o=i("00e7"),n=i.n(o);function a(e){for(var t in e){var i=e[t];"[object Object]"===Object.prototype.toString.call(i)&&(i=JSON.stringify(i)),n.a.set(t,i,{expires:"30D"})}}function r(e){for(var t in e)n.a.delete(e[t])}},ade3:function(e,t,i){"use strict";function o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,"a",(function(){return o}))},db16:function(e,t,i){"use strict";i.d(t,"c",(function(){return n})),i.d(t,"b",(function(){return a})),i.d(t,"a",(function(){return r}));var o=i("97af");function n(e,t){return Object(o["a"])({url:"api/v1.0/send/code",method:"post",data:{mobile:e,type:t}})}function a(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Object(o["a"])({url:"api/v1.0/login/verification",method:"post",data:{mobile:e,code:t,type:i}})}function r(e,t){return Object(o["a"])({url:"api/v1.0/login",method:"post",data:{mobile:e,pwd:t}})}}}]);