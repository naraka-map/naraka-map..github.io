(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1b4d449a"],{"1b62":function(e,t,i){"use strict";var n=i("495f"),a={computed:{inApp:function(){return Object(n["d"])()},shareLink:function(){return Object(n["b"])(location.href,"inapp")},clientType:function(){return Object(n["c"])()},isIOS:function(){return"isIos"===this.clientType},isAndroid:function(){return"isAnd"===this.clientType}}};t["a"]=a},"2cd5":function(e,t,i){},"55e2":function(e,t,i){},"568e":function(e,t,i){"use strict";i("2cd5")},"60a0":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"assassin-map-inter"},[i("NavigationBar",{attrs:{pageTitle:"刺客信条英灵殿",backAction:e.back,shareInfo:e.shareInfo,enableBack:e.inApp,enableShare:e.inApp}}),e.mapResource?i("Map",{ref:"mapvm",staticClass:"map",attrs:{zoom:6,tileImageProvider:e.mapTileGenerator,bounds:e.mapResource.bounds},on:{"click-map":e.showCreatePoiPopup}}):e._e(),i("Menubar",{staticClass:"menus",attrs:{items:e.menus},on:{"click-item":e.doMenuAction}}),i("PoiFilter",{directives:[{name:"show",rawName:"v-show",value:e.showFilter,expression:"showFilter"}],attrs:{items:e.categories},on:{close:function(t){e.showFilter=!1},"item-change":e.switchMarkersRelate,"all-item-change":e.switchAllMarkers}}),i("PoiRank",{directives:[{name:"show",rawName:"v-show",value:e.showRank,expression:"showRank"}],staticClass:"poi-rank",attrs:{items:e.ranks},on:{close:function(t){e.showRank=!1}}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showCreatePoiWindow,expression:"showCreatePoiWindow"}],staticClass:"create-poi-container",on:{click:function(t){return t.target!==t.currentTarget?null:e.cancelCreatePoi(t)}}},[i("div",{ref:"createPoiPopup",staticClass:"create-poi-popup",style:{top:e.createPoiPopupPositionTop+"px",left:e.createPoiPopupPositionLeft+"px"}},[i("el-select",{staticStyle:{width:"148px"},attrs:{placeholder:"选择点位类型",size:"mini"},model:{value:e.poiType,callback:function(t){e.poiType=t},expression:"poiType"}},e._l(e.poiTypes,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),i("div",{staticClass:"button",on:{click:e.createPoi}})],1)]),i("div",{staticClass:"rank"}),i("Login",{directives:[{name:"show",rawName:"v-show",value:e.showWebLogin,expression:"showWebLogin"}],on:{close:function(t){return e.switchWeblogin(!1)},login:e.webLoginSuccess}}),i("Sharebar",{directives:[{name:"show",rawName:"v-show",value:e.showShare,expression:"showShare"}],on:{close:function(t){e.showShare=!1},share:e.shareMapTo}}),i("script",{attrs:{id:"infowindow-template",type:"x-tmpl-mustache"}},[e._v(' <div style=" width: 32vh; height: 32vh; background-image: url(#{background}#); background-repeat: no-repeat; background-size: 100% 100%; display: flex; flex-direction: column; " > <div style=" width: 100%; height: 10vh; color: #5c5c5c; line-height: 10vh; text-align: center; font-weight: bold; font-size: 2vh; overflow: hidden; " > <span style=" display: inline-block; vertical-align: middle; line-height: 5vh; word-break: break-all; " >地点：#{place}#</span > </div> <div style=" width: 100%; height: 10vh; color: #5c5c5c; line-height: 10vh; text-align: center; font-weight: bold; font-size: 2.5vh; overflow: hidden; " > 先行者：#{person}# </div> <div style=" width: 100%; height: 12vh; display: flex; justify-content: center; align-items: center; " > <button style=" height: 5vh; width: 13vh; border-radius: 2.5vh; background-color: #3a393a; color: #ffffff; font-weight: bold; font-size: 2vh; margin-right: 1vh; cursor: pointer; " onclick="window.__tg_map_redirect_challenge__(\'#{target}#\', \'#{target_param}#\', #{native}#)" > 查看视频 </button> </div> </div> ')])],1)},a=[],o=(i("99af"),i("4160"),i("d81d"),i("b0c0"),i("7039"),i("d3b7"),i("ac1f"),i("25f0"),i("5319"),i("159b"),i("028d")),r=i("5c96"),s=i("a5c9"),c=i("cdca"),u=i("0a9b"),l=i("a3d2"),h=i("d55e"),p=i("d4a1"),f=i("9dbb"),d=i.n(f),m=i("4dec"),g=i("fdff"),v=i("495f"),w=i("7feb"),b=i("1b62"),P=i("b1b0"),k=i.n(P),y=!1,O={name:"AssassinMap",mixins:[b["a"]],metaInfo:function(){return{title:"刺客信条 | 高能时刻短视频",meta:[{hid:"description",name:"description",content:"高能时刻游戏短视频app，快来这个社区我给你看个宝贝"},{hid:"Keywords",name:"Keywords",content:"高能时刻,游戏短视频"}]}},components:{Map:s["a"],Menubar:u["a"],PoiFilter:l["a"],PoiRank:h["a"],Login:p["a"],Sharebar:c["a"],NavigationBar:o["a"]},data:function(){return{showShare:!1,mapResources:{asgard:{id:2,webpURL:"https://img.topgamers.cn/assassin/valhalla/webp/norway",pngURL:"https://img.topgamers.cn/assassin/valhalla/norway",shareTitle:"阿斯加德+挪威旅游局",shareContent:"维京人冒险攻略，征服阿斯加德+挪威，建立新的家园"},england:{id:3,webpURL:"https://img.topgamers.cn/assassin/valhalla/webp/england",pngURL:"https://img.topgamers.cn/assassin/valhalla/england",shareTitle:"英格兰旅游局",shareContent:"维京人冒险攻略，征服英格兰，建立新的家园"},jotunheim:{id:4,webpURL:"https://img.topgamers.cn/assassin/valhalla/webp/jotunheim",pngURL:"https://img.topgamers.cn/assassin/valhalla/jotunheim",shareTitle:"约顿海姆+文兰旅游局",shareContent:"维京人冒险攻略，征服约顿海姆+文兰，建立新的家园"}},mapResource:void 0,menus:[{id:0,title:"点位贡献",icon:"map-menu-assassin-my-create",action:"myPoi"},{id:1,title:"点位筛选",icon:"map-menu-assassin-poi-filter",action:"filterPoi"}],ranks:[],showFilter:!1,poiType:"",categories:[],markers:{},showCreatePoiWindow:!1,tempMarkerForAddingPoi:null,createPoiPopupPositionTop:0,createPoiPopupPositionLeft:0,showRank:!1,showWebLogin:!1,userInfo:{},loading:{instance:null,count:0},shareInfo:{}}},methods:{back:function(){this.$router.back()},generateShareInfo:function(){this.shareInfo={title:this.mapResource.shareTitle,subtitle:this.mapResource.shareContent,link:this.shareLink}},share:function(){this.showShare=!0},shareMapTo:function(e){var t=this,i=Object(v["b"])(location.href,"inapp");if("Copy2Clipboard"===e.identifier)this.$copyText(i).then((function(e){t.$toast("复制成功",{duration:1500})}),(function(e){alert("复制失败")}));else{var n={method:"share",appType:e.identifier,msgType:"link",url:i,imageUrl:"https://img.topgamers.cn/icon.png",title:t.mapResource.shareTitle,content:t.mapResource.shareContent};Object(v["a"])(n)}this.showShare=!1},resolveMapTarget:function(){var e=this;return new Promise((function(t,i){var n=e.mapTarget||"asgard";Object(v["g"])().then((function(i){var a=e.mapResources[n];a.url=i?a.webpURL:a.pngURL,a.postfix=i?"webp":"png",e.mapResource=a,t()}))}))},mapTileGenerator:function(e){var t=this.mapResource,i=t.url,n=t.postfix;return"".concat(i).concat(e).concat(n)},reloadMarkers:function(e){var t=this,i=e.is_mine,n={is_mine:i,activity_id:this.mapResource.id};n=Object.assign(n,this.userInfo),Object(m["c"])(n).then((function(e){var i=e;200===i.code?(t.resetMapData(),t.categories=i.data.categories.map((function(e){return e.active=!0,e})),t.pois=JSON.parse(i.data.list),Object.getOwnPropertyNames(t.pois).forEach((function(e){var i=t.pois[e];if("[object Array]"===Object.prototype.toString.call(i)){var n=[];i.forEach((function(e){var i=t.$refs.mapvm.addMarker({lat:+e.lat,lng:+e.lng,icon:e.marker},(function(i,n){t.showInfowindow(i,n,e)}));n.push(i)})),t.markers[e]=n}}))):t.$toast(i.msg,{duration:1500})}))},resetMapData:function(){var e=this;Object.getOwnPropertyNames(this.markers).forEach((function(t){var i=e.markers[t];"[object Array]"===Object.prototype.toString.call(i)&&i.forEach((function(e){e.removeFromMap()}))})),this.markers={}},reloadRank:function(){var e=this;Object(g["a"])(this.mapResource.id).then((function(t){var i=t.code,n=t.data;200===i&&(e.ranks=n)}))},doMenuAction:function(e){var t=this[e.action];t&&t(e)},myPoi:function(e){this.showRank=!0},filterPoi:function(e){this.showFilter=!0},showCreatePoiPopup:function(e){var t=this;this.showCreatePoiWindow=!0,this.$nextTick().then((function(){var i=e.latLng,n=i.lat,a=i.lng,o=e.pixel,r=o.x,s=o.y,c=t.$refs.createPoiPopup,u=c.offsetHeight,l=c.offsetWidth,h=window,p=h.innerHeight,f=h.innerWidth,d=r,m=f-r,g=s,v=p-s,w=40;t.createPoiPopupPositionLeft=d>m?r-w-l:r+w,(t.createPoiPopupPositionLeft+l>f||t.createPoiPopupPositionLeft<0)&&(t.createPoiPopupPositionLeft=(f-l)/2),t.createPoiPopupPositionTop=g>v?s-u:s+w+10,t.createPoiPopupPositionTop<0?t.createPoiPopupPositionTop=s+w:t.createPoiPopupPositionTop+u>p&&(t.createPoiPopupPositionTop=s-u-w);var b=t.$refs.mapvm.addMarker({lat:n(),lng:a()});t.tempMarkerForAddingPoi=b}))},cancelCreatePoi:function(){this.tempMarkerForAddingPoi.removeFromMap(),this.showCreatePoiWindow=!1},switchMarkersRelate:function(e){var t=this,i=this.markers["marker-".concat(e.id)];i&&i.forEach((function(i){e.active?i.setMap(t.$refs.mapvm.map):i.setMap(null)}))},switchAllMarkers:function(e){var t=this;this.categories.forEach((function(e){t.switchMarkersRelate(e)}))},createPoi:function(){var e=this;if(this.poiType)if(this.userInfo.userId){this.showLoading();var t=this.tempMarkerForAddingPoi.position,i={lat:"".concat(t.lat()),lng:"".concat(t.lng()),category_id:this.poiType,activity_id:this.mapResource.id,userId:this.userInfo.userId+"",sign:this.userInfo.sign,name:""};Object(m["a"])(i).then((function(t){setTimeout((function(){e.closeLoading();var i=t.code,n=t.msg;200===i?(e.$toast("创建成功，等待审核通过后将在地图上显示",{duration:3e3}),e.cancelCreatePoi()):e.$toast(n,{duration:3e3})}),1e3)}))}else this.requireLogin();else this.$toast("请先确定点位类型",{duration:1500})},showInfowindow:function(e,t,i){this.infowindow&&this.infowindow.close();var n=document.getElementById("infowindow-template").innerHTML;n=n.replace(/#{(\w+)}#/g,"{{$1}}");var a={background:k.a,place:i.name,person:i.first_member_name,target:i.redirect_type,target_param:i.redirect_params,native:y},o=d.a.render(n,a);this.infowindow=this.$refs.mapvm.createInfoWindow(e,o)},fetchUserInfo:function(){var e=this;if(y)Object(v["a"])({method:"getUserInfo"}).then((function(t){var i=JSON.parse(t)||{};e.userInfo=i;var n={USERINFO:i};return i.loginToken&&(n.LOGINTOKEN=i.loginToken),i.userId&&(n.USERID=i.userId),Object(w["b"])(n),Promise.resolve(e.userInfo)}));else try{this.userInfo=JSON.parse(this.$cookie.get("USERINFO"))||{}}catch(t){this.$cookie.remove("USERINFO")}},requireLogin:function(){var e=this;y?Object(v["a"])({method:"login"}).then((function(){return e.cancelCreatePoi(),Object(v["a"])({method:"getUserInfo"}).then((function(t){e.userInfo=JSON.parse(t);var i={USERINFO:t};return Object(w["b"])(i),Promise.resolve(e.userInfo)}))})):this.switchWeblogin(!0)},switchWeblogin:function(e){this.showWebLogin=e},webLoginSuccess:function(e){this.userInfo=JSON.parse(e),this.switchWeblogin(!1)},showLoading:function(){this.loading.instance||(this.loading.instance=r["Loading"].service({fullscreen:!0,background:"rgba(0, 0, 0, 0.65)"})),this.loading.count+=1},closeLoading:function(){var e=this;this.loading.count<=0||(this.loading.count-=1,this.loading.count<=0&&this.$nextTick((function(){e.loading.instance.close(),e.loading.instance=null})))}},computed:{createPoiPopupStyle:function(){return{top:"".concat(this.createPoiPopupPosition.top," px"),left:"".concat(this.createPoiPopupPosition.left," px")}},poiTypes:function(){return this.categories.map((function(e){return{label:e.name,value:e.id}}))},mapTarget:function(){return this.$route.params.target},defaultResource:function(){return{url:"https://img.topgamers.cn/assassin/valhalla",id:2}}},created:function(){var e=this;this.resolveMapTarget().then((function(){e.reloadMarkers({is_mine:!1}),e.reloadRank(),e.generateShareInfo()}))},mounted:function(){y=Boolean(this.$route.query.inapp),this.fetchUserInfo()}},T=O,R=(i("568e"),i("2877")),I=Object(R["a"])(T,n,a,!1,null,"2af126ce",null);t["default"]=I.exports},"7feb":function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"a",(function(){return r}));i("d3b7"),i("25f0");var n=i("00e7"),a=i.n(n);function o(e){for(var t in e){var i=e[t];"[object Object]"===Object.prototype.toString.call(i)&&(i=JSON.stringify(i)),a.a.set(t,i,{expires:"30D"})}}function r(e){for(var t in e)a.a.delete(e[t])}},9911:function(e,t,i){"use strict";var n=i("23e7"),a=i("857a"),o=i("af03");n({target:"String",proto:!0,forced:o("link")},{link:function(e){return a(this,"a","href",e)}})},ade3:function(e,t,i){"use strict";function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,"a",(function(){return n}))},c2da:function(e,t,i){"use strict";i("55e2")},d55e:function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"poi-rank-inter"},[i("div",{staticClass:"close"},[i("div",{staticClass:"button",on:{click:function(t){return e.$emit("close")}}})]),i("div",{staticClass:"content"},e._l(e.items,(function(t){return i("div",{key:t.id,staticClass:"item"},[i("img",{staticClass:"avatar",attrs:{src:t.avatar,alt:"头像"}}),i("span",{staticClass:"name text"},[e._v(e._s(t.nickname))]),i("span",{staticClass:"count text"},[e._v(e._s(t.lighting)+"个点")])])})),0)])},a=[],o={name:"PoiRank",props:{items:{type:Array,default:function(){return[]}}}},r=o,s=(i("c2da"),i("2877")),c=Object(s["a"])(r,n,a,!1,null,"5225ce98",null);t["a"]=c.exports},db16:function(e,t,i){"use strict";i.d(t,"c",(function(){return a})),i.d(t,"b",(function(){return o})),i.d(t,"a",(function(){return r}));var n=i("97af");function a(e,t){return Object(n["a"])({url:"api/v1.0/send/code",method:"post",data:{mobile:e,type:t}})}function o(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Object(n["a"])({url:"api/v1.0/login/verification",method:"post",data:{mobile:e,code:t,type:i}})}function r(e,t){return Object(n["a"])({url:"api/v1.0/login",method:"post",data:{mobile:e,pwd:t}})}},fdff:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var n=i("97af");function a(e){return Object(n["a"])({url:"/activity/api/v1.0/yuanshen/heroes",params:{activity_id:e}})}}}]);